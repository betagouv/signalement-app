<app-banner title="Suivi des signalements"
            [subTitle]="searchFormValue.siret ? 'SIRET ' + searchFormValue.siret : ''"
            [backButton]="siretUrlParam !== null">
</app-banner>

<app-page>


  <!--    <div class="filters">-->
  <!--      <form (ngSubmit)="submitFilters()" class="form-horizontal">-->
  <!--        <div class="row">-->
  <!--          <div class="col-12 col-sm-4">-->
  <!--            <div class="form-group">-->
  <!--              <label>-->
  <!--                Département(s)-->
  <!--              </label>-->
  <!--              <div class="btn-group" dropdown>-->
  <!--                <button id="button-basic" dropdownToggle type="button" class="dropdown-toggle" aria-controls="dropdown-basic">-->
  <!--                  {{reportFilter.areaLabel ? reportFilter.areaLabel : 'Tous les départements'}} <span class="caret"></span>-->
  <!--                </button>-->
  <!--                <ul id="dropdown-basic" *dropdownMenu class="dropdown-menu" role="menu" aria-labelledby="button-basic">-->
  <!--                  <li role="menuitem" class="menutitle">-->
  <!--                    <span class="pointer dropdown-item menutitle" (click)="selectArea()">-->
  <!--                      Tous les départements-->
  <!--                    </span>-->
  <!--                  </li>-->
  <!--                  <ng-container *ngFor="let region of regions">-->
  <!--                    <li class="divider dropdown-divider"></li>-->
  <!--                    <li class="menutitle pt-0" role="menuitem">-->
  <!--                      <span class="pointer dropdown-item menutitle" (click)="selectArea(region)">-->
  <!--                        {{region.label}}-->
  <!--                      </span>-->
  <!--                    </li>-->
  <!--                    <li role="menuitem" *ngFor="let department of region.departments">-->
  <!--                      <span class="pointer dropdown-item" (click)="selectArea(department)">-->
  <!--                        {{department.code}} - {{department.label}}-->
  <!--                      </span>-->
  <!--                    </li>-->
  <!--                  </ng-container>-->
  <!--                </ul>-->
  <!--              </div>-->
  <!--            </div>-->
  <!--            <div class="form-group">-->
  <!--              <label for="period">-->
  <!--                Période-->
  <!--              </label>-->
  <!--              <input type="text"-->
  <!--                     [(ngModel)]="reportFilter.period"-->
  <!--                     name="period"-->
  <!--                     id="period"-->
  <!--                     class="form-control"-->
  <!--                     placeholder="Daterangepicker"-->
  <!--                     placeholder="Période sélectionnée"-->
  <!--                     bsDaterangepicker-->
  <!--                     autocomplete="off"-->
  <!--                     placement="right"-->
  <!--                     [bsConfig]="{-->
  <!--                         containerClass: 'theme-default',-->
  <!--                         rangeInputFormat: 'DD MMMM YYYY'-->
  <!--                       }"-->
  <!--                     triggers="click keypress"/>-->
  <!--            </div>-->
  <!--            <div class="form-group">-->
  <!--              <label for="statusFilter">-->
  <!--                Statut-->
  <!--              </label>-->
  <!--              <select [(ngModel)]="reportFilter.status" id="statusFilter" name="status" class="form-control" [ngClass]="reportFilter.status ? 'selected' : ''">-->
  <!--                <option [ngValue]="undefined" selected>Tous les statuts</option>-->
  <!--                <option *ngFor="let status of statusList">-->
  <!--                  {{status}}-->
  <!--                </option>-->
  <!--              </select>-->
  <!--            </div>-->
  <!--          </div>-->
  <!--          <div class="col-12 col-sm-4">-->
  <!--            <div class="form-group">-->
  <!--              <label for="siretFilter">-->
  <!--                SIRET-->
  <!--              </label>-->
  <!--              <input type="text" [(ngModel)]="reportFilter.siret" placeholder="SIRET" id="siretFilter" name="siret" class="form-control"/>-->
  <!--            </div>-->
  <!--            <div class="form-group">-->
  <!--              <label for="hasCompanyFilter">-->
  <!--                Entreprise identifiée ?-->
  <!--              </label>-->
  <!--              <select [(ngModel)]="reportFilter.hasCompanyStr" id="hasCompanyFilter" name="hasCompany" class="form-control" [ngClass]="reportFilter.hasCompany ? 'selected' : ''">-->
  <!--                <option [ngValue]="undefined" selected>Indifférent</option>-->
  <!--                <option value="true">Oui</option>-->
  <!--                <option value="false">Non</option>-->
  <!--              </select>-->
  <!--            </div>-->
  <!--            <div class="form-group">-->
  <!--              <label for="emailFilter">-->
  <!--                Email conso.-->
  <!--              </label>-->
  <!--              <input type="text" [(ngModel)]="reportFilter.email" placeholder="Email consommateur" id="emailFilter" name="email" class="form-control"/>-->
  <!--            </div>-->
  <!--          </div>-->
  <!--          <div class="col-12 col-sm-4">-->
  <!--            <div class="form-group">-->
  <!--              <label for="categoryFilter">-->
  <!--                Catégorie-->
  <!--              </label>-->
  <!--              <select [(ngModel)]="reportFilter.category" id="categoryFilter" name="category" class="form-control" [ngClass]="reportFilter.category ? 'selected' : ''">-->
  <!--                <option [ngValue]="undefined" selected>Toutes les catégories</option>-->
  <!--                <option *ngFor="let category of categories">-->
  <!--                  {{category}}-->
  <!--                </option>-->
  <!--              </select>-->
  <!--            </div>-->
  <!--            <div class="form-group">-->
  <!--              <label for="tagsFilter">-->
  <!--                Tags-->
  <!--              </label>-->
  <!--              <select [(ngModel)]="tagFilterToAdd"-->
  <!--                      id="tagsFilter"-->
  <!--                      name="category"-->
  <!--                      (change)="addTagFilter()"-->
  <!--                      class="form-control">-->
  <!--                <option value="" selected>Sélectionner les tags à ajouter</option>-->
  <!--                <ng-container *ngFor="let tag of tags">-->
  <!--                  <option *ngIf="reportFilter.tags.indexOf(tag) === -1">{{tag}}</option>-->
  <!--                </ng-container>-->
  <!--              </select>-->
  <!--              <div>-->
  <!--                <span *ngFor="let tag of reportFilter.tags" class="badge badge-success m-1">-->
  <!--                  {{tag}}-->
  <!--                  <i class="material-icons pointer" (click)="removeTagFilter(tag)">close</i>-->
  <!--                </span>-->
  <!--              </div>-->
  <!--            </div>-->
  <!--            <div class="form-group">-->
  <!--              <label for="detailsFilter">-->
  <!--                Mots-clés&nbsp;<i class="material-icons md-dark" aria-hidden="true" title="Recherche dans les colonnes problème et description">help_outline</i>-->
  <!--              </label>-->
  <!--              <input type="text" [(ngModel)]="reportFilter.details" id="detailsFilter" name="details" class="form-control"/>-->
  <!--            </div>-->
  <!--          </div>-->
  <!--        </div>-->
  <!--        <div class="row">-->
  <!--          <div class="col-12 text-center">-->
  <!--            <button type="submit" class="btn btn-primary mr-3">Filtrer</button>-->
  <!--            <a (click)="launchExtraction()" class="pointer">-->
  <!--              <img alt="Exporter les signalements de la liste en XLS" title="Exporter en XLS" src="/assets/images/icon_export_xls.png"/>-->
  <!--            </a>-->
  <!--            <div class="link pointer mt-1" (click)="cancelFilters()">Effacer les filtres</div>-->
  <!--          </div>-->
  <!--        </div>-->
  <!--      </form>-->
  <!--    </div>-->

  <app-panel [loading]="loading" *appRole="[roles.Admin, roles.DGCCRF]">
    <app-report-list-search
      [searchForm]="searchForm"
      (extracted)="launchExtraction()"
      (searched)="onFiltersUpdate()"
      (cleared)="onClearFilters()">
    </app-report-list-search>

    <app-report-list-datatable
      [data]="data"
      [total]="totalCount"
      [pageSize]="searchFormValue.limit"
      (paginationChanged)="onPaginationChange($event)">
    </app-report-list-datatable>

    <!--          <div class="row">-->
    <!--            <div class="col-12 col-lg-6 offset-lg-3 text-center">-->
    <!--              <pagination [boundaryLinks]="true" [totalItems]="totalCount" [maxSize]="5" [itemsPerPage]="itemsPerPage" (pageChanged)="changePage($event)"-->
    <!--                          [(ngModel)]="currentPage" previousText="&lsaquo;" nextText="&rsaquo;" firstText="&laquo;" lastText="&raquo;" class="justify-content-center">-->
    <!--              </pagination>-->
    <!--            </div>-->
    <!--            <div class="col-12 col-lg-3 text-center">-->
    <!--              <label>Nombre par page</label>-->
    <!--              <select class="items-per-page-selector" [(ngModel)]="itemsPerPage" (change)="submitFilters()">-->
    <!--                <option>20</option>-->
    <!--                <option>50</option>-->
    <!--                <option>100</option>-->
    <!--              </select>-->
    <!--            </div>-->
    <!--          </div>-->
    <!--          <div class="table-responsive">-->
    <!--            <table class="table">-->
    <!--              <caption class="sr-only">Liste des signalements</caption>-->
    <!--              <thead>-->
    <!--              <tr>-->
    <!--                <th>Dep</th>-->
    <!--                <th *appRole="[roles.DGCCRF]">Commune</th>-->
    <!--                <th *appRole="[roles.DGCCRF]">SIRET</th>-->
    <!--                <th>Entreprise</th>-->
    <!--                <th>Problème</th>-->
    <!--                <th class="description">Description</th>-->
    <!--                <th *appRole="[roles.DGCCRF]">Date du constat</th>-->
    <!--                <th *appRole="[roles.Admin]" class="email">Consommateur</th>-->
    <!--                <th class="pj">Pièces jointes</th>-->
    <!--                <th class="status-header">Statut</th>-->
    <!--                <th class="action"></th>-->
    <!--              </tr>-->
    <!--              </thead>-->
    <!--              <tbody>-->
    <!--              <tr *ngIf="!loading && !reportsByDate?.length">-->
    <!--                <td colspan="8">-->
    <!--                  <span class="error" *ngIf="loadingError">Une erreur technique s'est produite</span>-->
    <!--                  <span *ngIf="!loadingError">Aucun signalement trouvé</span>-->
    <!--                </td>-->
    <!--              </tr>-->
    <!--              <ng-container *ngFor="let reportsByDate of reportsByDate">-->
    <!--                <tr *appRole="[roles.Admin]">-->
    <!--                  <td colspan="7" class="report-group">-->
    <!--                    {{reportsByDate.date}}-->
    <!--                  </td>-->
    <!--                </tr>-->
    <!--                <tr *ngFor="let report of reportsByDate.reports" class="pointer" (click)="displayReport(report)">-->
    <!--                  <td>{{report.company.postalCode | slice : 0 : 2}}</td>-->
    <!--                  <td *appRole="[roles.DGCCRF]">{{report.company.postalCode}}</td>-->
    <!--                  <td *appRole="[roles.DGCCRF]">{{report.company.siret}}</td>-->
    <!--                  <td>-->
    <!--                    <div [tooltip]="companyTooltip" *ngIf="report.company.name">-->
    <!--                      {{report.company.name}}-->
    <!--                      <ng-template #companyTooltip>-->
    <!--                        <div *ngFor="let line of report.company.address?.split(' - ')">{{line}}</div>-->
    <!--                      </ng-template>-->
    <!--                    </div>-->
    <!--                    <div [tooltip]="websiteTooltip" *ngIf="report.website">-->
    <!--                      {{report.website.hostname}}-->
    <!--                      <ng-template #websiteTooltip>-->
    <!--                        {{report.website.url}}-->
    <!--                      </ng-template>-->
    <!--                    </div>-->
    <!--                  </td>-->
    <!--                  <td>-->
    <!--                    <div [tooltip]="subcategoriesTooltip" class="pre">-->
    <!--                      {{report.category}}&nbsp;<i class="material-icons md-18" aria-hidden="true" title="Il existe des sous-catégories">keyboard_arrow_down</i>-->
    <!--                    </div>-->
    <!--                    <ng-template #subcategoriesTooltip>-->
    <!--                      {{report.category}}-->
    <!--                      <br/>-->
    <!--                      <span *ngFor="let subcategory of report.subcategories">-->
    <!--                          {{subcategory}}-->
    <!--                        <br />-->
    <!--                        </span>-->
    <!--                    </ng-template>-->
    <!--                  </td>-->
    <!--                  <td>-->
    <!--                    <ng-container *ngIf="getDetailContent(report.detailInputValues); let detail">-->
    <!--                      <div [tooltip]="detailsTooltip">-->
    <!--                        <span [innerHTML]="detail.firstLine"></span>-->
    <!--                        <br />-->
    <!--                        <span [innerHTML]="detail.secondLine"></span>-->

    <!--                        <span *ngIf="detail.hasNext">-->
    <!--                            &nbsp;<i class="material-icons md-18" aria-hidden="true" title="Il existe des détails supplémentaires">keyboard_arrow_down</i>-->
    <!--                          </span>-->
    <!--                      </div>-->
    <!--                      <ng-template #detailsTooltip>-->
    <!--                        <ng-container *ngFor="let detailInputValue of report.detailInputValues">-->
    <!--                          <span class="font-weight-bold" [innerHTML]="detailInputValue.label"></span>-->
    <!--                          &nbsp;-->
    <!--                          <span class="mb-2" [innerHTML]="detailInputValue.value"></span>-->
    <!--                          <br/>-->
    <!--                        </ng-container>-->
    <!--                      </ng-template>-->
    <!--                    </ng-container>-->
    <!--                  </td>-->
    <!--                  <td *appRole="[roles.DGCCRF]">-->
    <!--                    {{getReportingDate(report)}}-->
    <!--                  </td>-->
    <!--                  <td *appRole="[roles.Admin]">-->
    <!--                    <div [tooltip]="consumerTooltip" class="pre">-->
    <!--                      {{report.consumer.email | middleCrop : 25 }}&nbsp;-->
    <!--                      <span class="agreement" *ngIf="!report.contactAgreement">-->
    <!--                          <i class="material-icons md-red md-18" title="L'utilisateur ne souhaite pas être contacté">close</i>-->
    <!--                        </span>-->
    <!--                      <span class="agreement" *ngIf="report.contactAgreement">-->
    <!--                          <i class="material-icons md-green md-18" title="L'utilisateur souhaite être contacté">check</i>-->
    <!--                        </span>-->
    <!--                    </div>-->
    <!--                    <ng-template #consumerTooltip>-->
    <!--                      {{report.consumer.firstName}} {{report.consumer.lastName}}-->
    <!--                      <br />-->
    <!--                      {{report.consumer.email}}-->
    <!--                      <br />-->
    <!--                      Accord pour contact : {{report.contactAgreement ? 'oui' : 'non'}}-->
    <!--                    </ng-template>-->
    <!--                  </td>-->
    <!--                  <td class="pre">-->
    <!--                      <span *ngFor="let file of report.consumerUploadedFiles | slice : 0 : 2; let isFirst=first;" [tooltip]="file.filename">-->
    <!--                        <a href="{{getFileDownloadUrl(file)}}" (click)="$event.stopPropagation()">-->
    <!--                          {{file.displayedFilenameSmall}}-->
    <!--                        </a>-->
    <!--                        <br *ngIf="isFirst" />-->
    <!--                      </span>-->
    <!--                    <span *ngIf="report.consumerUploadedFiles.length > 2" [tooltip]="moreFileTooltip">&nbsp;<i class="material-icons md-18" aria-hidden="true" title="Il existe des sous-catégories">keyboard_arrow_down</i></span>-->
    <!--                    <ng-template #moreFileTooltip>-->
    <!--                      <span *ngFor="let file of report.consumerUploadedFiles">{{file.filename}}<br /></span>-->
    <!--                    </ng-template>-->
    <!--                  </td>-->
    <!--                  <td [ngStyle]="{'background-color': statusColor.get(report.status)}">-->
    <!--                    {{ report.status }}-->
    <!--                  </td>-->
    <!--                  <td class="action" (click)="$event.stopPropagation()">-->
    <!--                    <a [routerLink]="['/suivi-des-signalements', 'report', report.id]" target="_blank">-->
    <!--                      <i class="material-icons text-primary md-18">open_in_new</i>-->
    <!--                    </a>-->
    <!--                  </td>-->
    <!--                </tr>-->
    <!--              </ng-container>-->
    <!--              </tbody>-->
    <!--            </table>-->
    <!--          </div>-->
    <!--          <div class="row">-->
    <!--            <div class="col-12 col-lg-6 offset-lg-3 text-center">-->
    <!--              <pagination [boundaryLinks]="true" [totalItems]="totalCount" [maxSize]="5" [itemsPerPage]="itemsPerPage" (pageChanged)="changePage($event)"-->
    <!--                          [(ngModel)]="currentPage" previousText="&lsaquo;" nextText="&rsaquo;" firstText="&laquo;" lastText="&raquo;" class="justify-content-center">-->
    <!--              </pagination>-->
    <!--            </div>-->
    <!--            <div class="col-12 col-lg-3 text-center">-->
    <!--              <label>Nombre par page</label>-->
    <!--              <select class="items-per-page-selector" [(ngModel)]="itemsPerPage" (change)="submitFilters()">-->
    <!--                <option>20</option>-->
    <!--                <option>50</option>-->
    <!--                <option>100</option>-->
    <!--              </select>-->
    <!--            </div>-->
    <!--          </div>-->
  </app-panel>
</app-page>
