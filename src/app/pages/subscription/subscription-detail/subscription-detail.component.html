<app-banner title="Détail de l'abonnement" [backButton]="true"></app-banner>

<main role="main">

  <section class="section section-lightest-grey position-relative pb-0">
    <div class="container">
      <div class="panel">

        <form [formGroup]="departmentForm" id="departmentForm" (submit)="addToDepartementFilter()" *ngIf="departmentForm">
          <div class="row">
            <div class="col-6">
              <label>
                <strong>Départements</strong>
              </label>
              <table class="table table-sm">
                <tbody>
                <tr *ngIf="!subscription.departments.length">
                  <td colspan="2" class="text-left">
                    Tous
                  </td>
                </tr>
                <tr *ngFor="let dept of subscription.departments">
                  <td class="text-left">
                    {{dept.code}} - {{dept.label}}
                  </td>
                  <td class="text-right pointer">
                    <i class="material-icons md-18 text-warning" title="Supprimer" (click)="removeFromDepartementFilter(dept)">cancel</i>
                  </td>
                </tr>
                </tbody>
              </table>
            </div>
            <div class="col-6">
              <label>
                Ajouter des départements<br/>
              </label>
              <input [formControl]="departmentCtrl" type="text" placeholder="75, 87, 971...">
              <p class="note">
                Saisissez un ou plusieurs code département séparés par des virgules et validez par entrée
              </p>
            </div>
          </div>
        </form>

        <hr />

        <form [formGroup]="categoryForm" id="categoryForm" *ngIf="categoryForm">
          <div class="row">
            <div class="col-6">
              <label>
                <strong>Catégories</strong>
              </label>
              <table class="table table-sm">
                <tbody>
                <tr *ngIf="!subscription.categories.length">
                  <td colspan="2" class="text-left">
                    Toutes
                  </td>
                </tr>
                <tr *ngFor="let category of subscription.categories">
                  <td class="text-left">
                    {{category}}
                  </td>
                  <td class="text-right pointer">
                    <i class="material-icons md-18 text-warning" title="Supprimer" (click)="removeFromCategoryFilter(category)">cancel</i>
                  </td>
                </tr>
                </tbody>
              </table>
            </div>
            <div class="col-6">
              <label>
                Ajouter une catégorie<br/>
              </label>
              <select [formControl]="categoryCtrl" (change)="addToCategoryFilter()">
                <option disabled ngValue="">Sélectionnez une catégorie pour l'ajouter</option>
                <option *ngFor="let category of categories">
                  {{category}}
                </option>
              </select>
            </div>
          </div>
        </form>

        <hr />

        <form [formGroup]="siretForm" id="siretForm" (submit)="addToSiretFilter()" *ngIf="siretForm">
          <div class="row">
            <div class="col-6">
              <label>
                <strong>Numéros SIRET</strong>
              </label>
              <table class="table table-sm">
                <tbody>
                <tr *ngIf="!subscription.sirets.length">
                  <td colspan="2" class="text-left">
                    Tous
                  </td>
                </tr>
                <tr *ngFor="let siret of subscription.sirets">
                  <td class="text-left">
                    {{siret}}
                  </td>
                  <td class="text-right pointer">
                    <i class="material-icons md-18 text-warning" title="Supprimer" (click)="removeFromSiretFilter(siret)">cancel</i>
                  </td>
                </tr>
                </tbody>
              </table>
            </div>
            <div class="col-6">
              <label>
                Ajouter un numéro SIRET<br/>
              </label>
              <input [formControl]="siretCtrl" type="text" placeholder="12002503600035...">
              <p class="note">
                Saisissez un ou plusieurs numéros SIRET séparés par des virgules et validez par entrée
              </p>
            </div>
          </div>
        </form>

        <hr />

        <div class="notification info">
          Vous recevrez un mail tous les matins avec les nouveaux signalements correspondants aux départements, catégories et numéros SIRET définis ci-dessus.
        </div>

        <div class="notification error" *ngIf="loadingError">
          Une erreur technique s'est produite<br />
        </div>

        <div class="mt-4 text-center">
          <button type="button" class="btn btn-lg btn-outline-primary" (click)="cancel()">Annuler</button>
          &nbsp;
          <button type="button" class="btn btn-lg btn-primary" (click)="submitSubscription()">
            Enregistrer
          </button>
        </div>
      </div>
    </div>
  </section>
</main>
