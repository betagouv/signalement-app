<app-banner [backButton]="backEnabled()">
  <h1 class="text-center">
    Détail du signalement
    <a [routerLink]="['/comment-ça-marche/professionnel']" fragment="le-detail" *appRole="[roles.Pro]"><i class="material-icons md-24 md-light" aria-hidden="true">help_outline</i></a>
  </h1>
  <h2 class="text-center" *appRole="[roles.Admin, roles.DGCCRF]">
    {{report?.id}}
  </h2>
</app-banner>

<section class="section section-white position-relative pb-0">
  <div class="container">
    <div class="panel">
      <div class="text-center" *ngIf="loadingError && !report">
        <span class="error">
          Une erreur s'est produite lors de la récupération de ce signalement.
        </span>
      </div>
      <ng-container *ngIf="report">
        <div class="row">
          <div class="col-3">
            <div class="badge" [ngStyle]="{'background-color': statusColor.get(report.status)}">{{report.status}}</div>

            <ng-container *appRole="[roles.Admin, roles.DGCCRF]">
              <div class="text-primary font-weight-bold pt-3">
                Consommateur
                <i class="material-icons md-18 text-primary pl-1 pb-1 pointer" aria-hidden="true" title="Détail du signalement"
                   (click)="openModal(updateConsumer)"
                   *appPermission="permissions.updateReport">
                  edit
                </i>
              </div>
              <div *ngIf="!report.contactAgreement;">Le consommateur souhaite rester anonyme</div>
              <div>
                Nom : {{report.consumer.lastName}}
                <br />
                Prénom : {{report.consumer.firstName}}
                <br />
                Email : {{report.consumer.email}}
              </div>
              <ng-template #updateConsumer>
                <div class="modal-body">
                  <form [formGroup]="consumerForm" (submit)="submitConsumerForm()" id="consumerForm">
                    <div class="form__group">
                      <div class="row">
                        <div class="col-12 col-sm-6">
                          <label for="firstName"> Prénom <span class="error">*</span></label>
                          <input type="text" formControlName="firstName" id="firstName">
                        </div>
                        <div class="col-12 col-sm-6">
                          <label for="lastName">Nom <span class="error">*</span></label>
                          <input type="text" formControlName="lastName" id="lastName">
                        </div>
                      </div>
                    </div>
                    <div class="form__group">
                      <label for="email">Email <span class="error">*</span></label>
                      <input type="email" formControlName="email" id="email"/>
                    </div>
                    <div class="form__group" *ngIf="consumerForm.contains('contactAgreement')">
                      <div class="row">
                        <div class="col-2 col-sm-1 text-right pr-1">
                          <input type="checkbox" formControlName="contactAgreement" id="contactAgreement"/>
                        </div>
                        <div class="col-10 col-sm-11 pl-1">
                          <label class="d-block mb-0 pointer" for="contactAgreement">
                            Accord pour contact par entreprise
                          </label>
                        </div>
                      </div>
                    </div>

                    <div class="notification error" *ngIf="loadingError">
                      Une erreur technique s'est produite<br />
                    </div>

                    <hr />
                    <div class="col-12 text-center">
                      <button type="submit" class="btn btn-primary mt-2" id="submitConsumerForm" [disabled]="consumerForm.invalid">
                        Valider
                      </button>
                    </div>
                  </form>
                </div>
              </ng-template>
            </ng-container>

            <ng-container *appRole="[roles.Pro]">
              <div class="text-primary font-weight-bold pt-3">
                Consommateur
              </div>
              <div *ngIf="!report.contactAgreement; else contactAgreement">Le consommateur souhaite rester anonyme</div>
              <ng-template #contactAgreement>
                Nom : {{report.consumer.lastName}}
                <br />
                Prénom : {{report.consumer.firstName}}
                <br />
                Email : {{report.consumer.email}}
              </ng-template>
            </ng-container>

            <ng-container *appRole="[roles.Admin, roles.DGCCRF]">
              <div class="text-primary font-weight-bold pt-3">
                Entreprise
                <i class="material-icons md-18 text-primary pl-1 pb-1 pointer" aria-hidden="true" title="Détail du signalement"
                   (click)="openModal(companySearch)"
                   *appPermission="permissions.updateReport">
                  edit
                </i>
              </div>
              <ng-container *ngIf="report.company.name">
                SIRET : {{report.company.siret}}
                <br/>
                Nom : {{report.company.name}}
                <br/>
                Adresse : {{report.company.address}}
              </ng-container>
              <div *ngIf="report.website.url">
                Site internet : {{report.website.url}}
              </div>

              <ng-template #companySearch>
                <div class="modal-body text-center">
                  <form [formGroup]="companySiretForm" (submit)="submitCompanySiretForm()" id="companyForm">
                    <input [formControl]="siretCtrl" placeholder="SIRET de l'entreprise" />

                    <div class="notification error" *ngIf="!companySearchBySiretResult && loadingError">
                      Une erreur technique s'est produite<br />
                    </div>

                    <hr />
                    <button type="submit" class="btn btn-primary mt-2" id="submitCompanyForm" [disabled]="companySiretForm.invalid">
                      Rechercher
                    </button>
                  </form>
                  <div *ngIf="companySearchBySiretResult">
                    <hr />
                    <div *ngIf="!companySearchBySiretResult.siret">
                      Aucun établissement trouvé
                    </div>
                    <div *ngIf="companySearchBySiretResult.siret">
                      <p class="company">
                        <strong *ngIf="companySearchBySiretResult.line1">{{companySearchBySiretResult.line1}}<br /></strong>
                        <strong *ngIf="companySearchBySiretResult.line2">{{companySearchBySiretResult.line2}}<br /></strong>
                        <span *ngIf="companySearchBySiretResult.line3">{{companySearchBySiretResult.line3}}<br /></span>
                        <span *ngIf="companySearchBySiretResult.line4">{{companySearchBySiretResult.line4}}<br /></span>
                        <span *ngIf="companySearchBySiretResult.line5">{{companySearchBySiretResult.line5}}<br /></span>
                        <span *ngIf="companySearchBySiretResult.line6">{{companySearchBySiretResult.line6}}<br /></span>
                        <span *ngIf="companySearchBySiretResult.line7">{{companySearchBySiretResult.line7}}<br /></span>
                      </p>

                      <div class="notification error" *ngIf="loadingError">
                        Une erreur technique s'est produite<br />
                      </div>

                      <hr />
                      <button type="button" class="btn btn-outline-primary" (click)="bsModalRef.hide()">Annuler</button>
                      &nbsp;
                      <button type="button" class="btn btn-primary" (click)="changeCompany(companySearchBySiretResult)">Valider</button>
                    </div>
                  </div>
                </div>
              </ng-template>
            </ng-container>

            <ng-container>
              <div class="text-primary font-weight-bold pt-4">
                Historique
              </div>
              <div class="pt-1">
                <small class="text-darker-grey">
                  <i>{{report.creationDate | date : 'mediumDate'}}</i>
                </small>
                <br />
                Signalement du consommateur
              </div>
              <div class="row" *appRole="[roles.Admin, roles.DGCCRF]">
                <div class="col-12" *ngFor="let event of events; let eventIndex = index">
                  <ng-container *ngIf="event.data.details && event.data.details.description; else noDescription">
                    <div class="pt-2">
                      <small class="text-darker-grey">
                        <i>{{event.data.creationDate | date : 'mediumDate'}}</i>
                      </small>
                      <ng-template *ngTemplateOutlet="eventUser; context: {$implicit: event}"></ng-template>
                      <br />
                      <a data-toggle="collapse" class="collapsable collapsed" href="#collapse{{eventIndex}}">
                        <span class="collapsed-icon">&#43;</span>
                        <span class="uncollapsed-icon">&#8722;</span>
                        {{event.data.action.value}}
                      </a>
                    </div>
                    <div class="collapse pl-3 pb-3" id="collapse{{eventIndex}}">
                      {{event.data.details.description}}
                    </div>
                  </ng-container>
                  <ng-template #noDescription>
                    <div class="pt-2">
                      <small class="text-darker-grey">
                        <i>{{event.data.creationDate | date : 'mediumDate'}}</i>
                      </small>
                      <br />
                      <ng-template *ngTemplateOutlet="eventUser; context: {$implicit: event}"></ng-template>
                      <br />
                      {{event.data.action.value}}
                    </div>
                  </ng-template>
                  <ng-template #eventUser let-event>
                   <small class="text-darker-grey" *ngIf="event.user"> <br />[{{event.user.firstName}} {{event.user.lastName}} ({{event.user.role}})]</small>
                  </ng-template>
                </div>
              </div>
              <ng-container *appRole="[roles.Pro]">

                <div class="pt-2" *ngIf="getEvent(eventActionValues.FirstVisit)">
                  <small class="text-darker-grey">
                    <i>{{getEvent(eventActionValues.FirstVisit).data.creationDate | date : 'mediumDate'}}</i>
                  </small>
                  <br />
                  Première consultation
                </div>

                <div class="pt-2" *ngIf="getReportResponse()">
                  <small class="text-darker-grey">
                    <i>{{getEvent(eventActionValues.ReportResponse).data.creationDate | date : 'mediumDate'}}</i>
                  </small>
                  <br />
                  Réponse au signalement
                </div>
              </ng-container>
            </ng-container>
          </div>
          <div class="offset-1 col-8">
            <ng-container>
              <h2 class="text-primary">Type de signalement</h2>
              <div class="text-darker-grey pb-3">
                Les catégories du signalement sont sélectionnées par le consommateur.
              </div>
              <div class="row">
                <div class="col-12 p-1">
                  <i class="material-icons md-18 text-primary">keyboard_arrow_right</i> {{report.category}}
                </div>
                <div class="col-12 p-1" *ngFor="let subcategory of report.subcategories">
                  <i class="material-icons md-18 text-primary">keyboard_arrow_right</i> {{subcategory}}
                </div>
              </div>
              <h2 class="text-primary pt-4">Message du consommateur</h2>
              <div class="text-dark-blue font-weight-bold">
                Informations complémentaires
              </div>
              <div class="row">
                <div class="col-12">
                  <div class="flex" *ngFor="let detailInputValue of report.detailInputValues">
                    <span [innerHTML]="detailInputValue.label"></span>
                    &nbsp;<span [innerHTML]="detailInputValue.value"></span>
                  </div>
                </div>
              </div>
              <div class="row pt-3" *ngIf="report.consumerUploadedFiles && report.consumerUploadedFiles.length">
                <div class="col-12">
                  <div class="text-dark-blue font-weight-bold">
                    {{report.consumerUploadedFiles.length === 1 ? 'Pièce jointe' : 'Pièces jointes'}}
                  </div>
                  <table class="table table-sm">
                    <tbody>
                    <tr *ngFor="let uploadedFile of report.consumerUploadedFiles">
                      <td class="text-left pl-2">
                        <a href="{{getFileDownloadUrl(uploadedFile)}}">
                        <span *ngIf="uploadedFile.id">
                          {{uploadedFile.filename}}
                        </span>
                        </a>
                      </td>
                      <td class="text-right pointer" *appPermission="permissions.deleteFile">
                        <img class="remove" alt="Icône du bouton suppression" src="/assets/images/icon_remove.png" (click)="openModal(removeTemplate)">
                      </td>
                      <ng-template #removeTemplate>
                        <div class="modal-body text-center">
                          <p>Voulez-vous supprimer cette pièce jointe ?</p>
                          <button type="button" class="btn btn-outline-primary" (click)="bsModalRef.hide()">Non</button>
                          &nbsp;
                          <button type="button" class="btn btn-primary" (click)="removeUploadedFile(uploadedFile)" >Oui</button>
                        </div>
                      </ng-template>
                    </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </ng-container>

            <ng-container *ngIf="getReportResponse()">
              <h2 class="text-primary pt-4" *appRole="[roles.Pro]; else titleAnswerNoPro">Réponse apportée</h2>
              <ng-template #titleAnswerNoPro>
                <h2 class="text-primary pt-4">
                  Réponse apportée par l'entreprise
                </h2>
              </ng-template>
              <div class="row" id="proAnswer">
                <div class="col-12 pt-1" [ngSwitch]="getReportResponse().responseType">
                  <i class="material-icons md-18 text-primary">keyboard_arrow_right</i>
                  <span *ngSwitchCase="reportResponseTypes.Accepted">Signalement pris en compte</span>
                  <span *ngSwitchCase="reportResponseTypes.Rejected">Signalement infondé</span>
                  <span *ngSwitchCase="reportResponseTypes.NotConcerned">Etablissement non concerné par le signalement</span>
                </div>
              </div>
              <div class="text-dark-blue font-weight-bold pt-3">
                Réponse au consommateur
              </div>
              <div class="bg-lightest-blue p-2">
                {{getReportResponse().consumerDetails}}
              </div>
              <ng-container *ngIf="getReportResponse().dgccrfDetails">
                <div class="text-dark-blue font-weight-bold pt-3">
                  Réponse à la DGCCRF
                </div>
                <div class="bg-lightest-blue p-2">
                  {{getReportResponse().dgccrfDetails}}
                </div>
              </ng-container>
            </ng-container>
            <div class="row pt-3" *ngIf="report.professionalUploadedFiles && report.professionalUploadedFiles.length">
              <div class="col-12">
                <div class="text-dark-blue font-weight-bold">
                  {{report.professionalUploadedFiles.length === 1 ? 'Pièce jointe' : 'Pièces jointes' }}
                </div>
                <table class="table table-sm">
                  <tbody>
                  <tr *ngFor="let uploadedFile of report.professionalUploadedFiles">
                    <td class="text-left pl-2">
                      <a href="{{getFileDownloadUrl(uploadedFile)}}">
                    <span *ngIf="uploadedFile.id">
                      {{uploadedFile.filename}}
                    </span>
                      </a>
                    </td>
                    <td class="text-right pointer" *appPermission="permissions.deleteFile">
                      <img class="remove" alt="Icône du bouton suppression" src="/assets/images/icon_remove.png" (click)="openModal(removeTemplate)">
                    </td>
                    <ng-template #removeTemplate>
                      <div class="modal-body text-center">
                        <p>Voulez-vous supprimer cette pièce jointe ?</p>
                        <button type="button" class="btn btn-outline-primary" (click)="bsModalRef.hide()">Non</button>
                        &nbsp;
                        <button type="button" class="btn btn-primary" (click)="removeUploadedFile(uploadedFile)" >Oui</button>
                      </div>
                    </ng-template>
                  </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>

        <ng-container *appPermission="permissions.deleteReport">
          <hr />
          <button type="submit" class="btn btn-danger" (click)="openModal(delete)">
            Supprimer ce signalement
          </button>
          <ng-template #delete>
            <div class="modal-body text-center" *ngIf="report.consumerUploadedFiles && report.consumerUploadedFiles.length; else noFiles">
              Vous devez supprimer toutes les pièces jointes avant de pouvoir supprimer le signalement.
              <br />
              <button type="button" class="btn btn-outline-primary" (click)="bsModalRef.hide()">Fermer</button>
            </div>
            <ng-template #noFiles>
              <div class="modal-body text-center">
                <p>
                  Pour confirmer la suppression définitive du signalement, recopiez l'identifiant du signalement :
                  <br/>
                  {{reportId}}
                </p>
                <input [(ngModel)]="reportIdToDelete" class="mb-3" placeholder="Identifiant du signalement">

                <div class="notification error" *ngIf="loadingError">
                  Une erreur technique s'est produite<br />
                </div>

                <hr />
                <button type="button" class="btn btn-outline-primary" (click)="bsModalRef.hide()">Annuler</button>
                &nbsp;
                <button type="button" class="btn btn-danger" (click)="deleteReport()" [disabled]="reportId !== reportIdToDelete">Confirmer la suppression</button>
              </div>
            </ng-template>
          </ng-template>
        </ng-container>
        <button *appRole="[roles.Admin, roles.DGCCRF];" type="button" class="btn btn-secondary ml-3" (click)="downloadReport()">Télécharger <i class="material-icons">picture_as_pdf</i></button>
      </ng-container>
      <ngx-loading [show]="!report && loading"></ngx-loading>
    </div>

    <ng-container *appRole="[roles.Pro]">
      <div *ngIf="report && !getReportResponse() && ! isClosed()">
        <div class="pb-3 text-center" *ngIf="!responseForm; else proAnswer">
          <p>
            Votre réponse est importante. Elle sera visible par le consommateur et la DGCCRF.
            <a [routerLink]="['/comment-ça-marche/professionnel']" fragment="la-reponse" ><i class="material-icons md-24" aria-hidden="true">help_outline</i></a>
          </p>
          <div class="mb-4">
            <button class="btn btn-primary btn-lg" (click)="showProAnswerForm()" id="answerBtn">Apporter une réponse à ce signalement</button>
          </div>
        </div>
        <ng-template #proAnswer>
          <div class="notification">
            <form [formGroup]="responseForm" (submit)="submitProAnswerForm()" id="proAnswerForm">

              <div class="form__group">
                <label class="text-center" [class]="hasError(responseTypeCtrl) ? 'error' : ''">
                  Pouvez-vous préciser votre réponse ? <span class="error">*</span>
                </label>
                <div [class]="getTypeClass(reportResponseTypes.Accepted)">
                  <div class="row pb-2 pt-2">
                    <div class="col-2 col-sm-1 text-right pr-1">
                      <input type="radio" [formControl]="responseTypeCtrl" [value]="reportResponseTypes.Accepted" id="reportAccepted"/>
                    </div>
                    <div class="col-10 col-sm-11 pl-1">
                      <label for="reportAccepted" class="label-inline pointer">Je prends en compte ce signalement</label>
                    </div>
                  </div>
                </div>
                <div [class]="getTypeClass(reportResponseTypes.Rejected)">
                  <div class="row pb-2 pt-2">
                    <div class="col-2 col-sm-1 text-right pr-1">
                      <input type="radio" [formControl]="responseTypeCtrl" [value]="reportResponseTypes.Rejected" id="reportRejected"/>
                    </div>
                    <div class="col-10 col-sm-11 pl-1">
                      <label for="reportRejected" class="label-inline pointer">J'estime que ce signalement est infondé</label>
                    </div>
                  </div>
                </div>
                <div [class]="getTypeClass(reportResponseTypes.NotConcerned)">
                  <div class="row pb-2 pt-2">
                    <div class="col-2 col-sm-1 text-right pr-1">
                      <input type="radio" [formControl]="responseTypeCtrl" [value]="reportResponseTypes.NotConcerned" id="reportNotConcerned"/>
                    </div>
                    <div class="col-10 col-sm-11 pl-1">
                      <label for="reportNotConcerned" class="label-inline pointer">J'estime que ce signalement ne concerne pas mon établissement</label>
                    </div>
                  </div>
                </div>
              </div>

              <ng-container *ngIf="responseTypeCtrl.valid">

                <div class="form__group pb-2">
                  <label for="proAnswerInput" [class]="hasError(responseConsumerDetailsCtrl) ? 'error' : ''" [ngSwitch]="responseTypeCtrl.value">
                    <span *ngSwitchCase="reportResponseTypes.Accepted">Détaillez les actions préventives / correctives que vous allez mettre en place.</span>
                    <span *ngSwitchDefault>Apportez une réponse au consommateur</span>
                    <span class="error">*</span>
                  </label>
                  <textarea [formControl]="responseConsumerDetailsCtrl" id="proAnswerInput" rows="3" placeholder="Cette réponse sera envoyée automatiquement par mail au consommateur et pourra être consultée par la DGCCRF.">
                  </textarea>
                  <p class="note">
                    Nous vous demandons de rester courtois dans votre réponse. Les menaces et insultes n'ont pas leur place dans SignalConso !
                  </p>
                </div>

                <hr />

                <div class="form__group pt-2">
                  <label for="proAnswerDgccrfInput">
                    Vous pouvez également, si vous le souhaitez, apporter une précision <b>à l'attention de la DGCCRF</b> qui ne sera pas transmise au consommateur
                  </label>
                  <textarea [formControl]="responseDgccrfDetailsCtrl" id="proAnswerDgccrfInput" rows="3" placeholder="Cette réponse pourra être consultée par la DGCCRF uniquement.">
                  </textarea>
                </div>

                <div class="form__group">
                  <app-attachments label="Pièces jointes <b>visibles uniquement par la DGCCRF</b>"
                                   [uploadedFiles]="uploadedFiles"
                                   [origin]="fileOrigins.Professional">
                  </app-attachments>
                </div>

              </ng-container>

              <div class="notification error" *ngIf="showErrors && responseForm.invalid">
                Veuillez renseigner les champs obligatoires.<br />
              </div>

              <div class="notification error" *ngIf="loadingError">
                Une erreur technique s'est produite<br />
              </div>

              <div class="mt-4 text-center">
                <button type="button" class="btn btn-lg btn-outline-primary" (click)="hideProAnswerForm()">Annuler</button>
                &nbsp;
                <button type="submit" class="btn btn-lg btn-primary" [disabled]="isUploadingFile()">
                  Envoyer
                </button>
              </div>
            </form>
            <ngx-loading [show]="loading"></ngx-loading>
          </div>
        </ng-template>
      </div>
    </ng-container>

    <ng-container *appRole="[roles.Admin, roles.DGCCRF]">
      <div *ngIf="report">
        <div class="pb-3 text-center" *ngIf="!actionForm; else actionFormTpl">
          <div class="mb-4">
            <button class="btn btn-primary btn-lg" (click)="showActionForm()" *appRole="[roles.DGCCRF]">
              Ajouter des informations DGCCRF
            </button>
            <button class="btn btn-primary btn-lg" (click)="showActionForm()" *appRole="[roles.Admin]">
              Ajouter des informations
            </button>
          </div>
        </div>
        <ng-template #actionFormTpl>
          <div class="notification">
            <form [formGroup]="actionForm" (submit)="submitActionForm()" id="actionForm">

              <div class="form__group">
                <label class="text-center" [class]="hasError(actionTypeCtrl) ? 'error' : ''">
                  Pouvez-vous préciser ? <span class="error">*</span>
                </label>
                <div [class]="getTypeClass(eventActionValues.Comment)">
                  <div class="row pb-2 pt-2">
                    <div class="col-2 col-sm-1 text-right pr-1">
                      <input type="radio" [formControl]="actionTypeCtrl" [value]="eventActionValues.Comment" id="commentAction"/>
                    </div>
                    <div class="col-10 col-sm-11 pl-1">
                      <label for="commentAction" class="label-inline pointer">Commentaire (interne à la DGCCRF)</label>
                    </div>
                  </div>
                </div>
                <div [class]="getTypeClass(eventActionValues.ConsumerAttachments)" *appRole="[roles.Admin]">
                  <div class="row pb-2 pt-2">
                    <div class="col-2 col-sm-1 text-right pr-1">
                      <input type="radio" [formControl]="actionTypeCtrl" [value]="eventActionValues.ConsumerAttachments" id="consumerAttachmentsAction"/>
                    </div>
                    <div class="col-10 col-sm-11 pl-1">
                      <label for="consumerAttachmentsAction" class="label-inline pointer">Pièces jointes fournies par le consommateur</label>
                    </div>
                  </div>
                </div>
                <div [class]="getTypeClass(eventActionValues.ProfessionalAttachments)" *appRole="[roles.Admin]">
                  <div class="row pb-2 pt-2">
                    <div class="col-2 col-sm-1 text-right pr-1">
                      <input type="radio" [formControl]="actionTypeCtrl" [value]="eventActionValues.ProfessionalAttachments" id="proAttachmentsAction"/>
                    </div>
                    <div class="col-10 col-sm-11 pl-1">
                      <label for="proAttachmentsAction" class="label-inline pointer">Pièces jointes fournies par l'entreprise</label>
                    </div>
                  </div>
                </div>
                <div [class]="getTypeClass(eventActionValues.Control)" *appRole="[roles.DGCCRF]">
                  <div class="row pb-2 pt-2">
                    <div class="col-2 col-sm-1 text-right pr-1">
                      <input type="radio" [formControl]="actionTypeCtrl" [value]="eventActionValues.Control" id="controlAction"/>
                    </div>
                    <div class="col-10 col-sm-11 pl-1">
                      <label for="controlAction" class="label-inline pointer">Contrôle effectué (interne à la DGCCRF)</label>
                    </div>
                  </div>
                </div>
              </div>

              <ng-container *ngIf="actionTypeCtrl.valid">

                <div class="form__group mt-4" *ngIf="actionTypeCtrl.value === eventActionValues.Comment">
                  <div class="row">
                    <div class="col-12">
                      <label for="commentInput" [class]="hasError(detailCtrl) ? 'error' : ''">
                        Commentaire <span class="error">*</span>
                      </label>
                      <textarea id="commentInput" [formControl]="detailCtrl"></textarea>
                    </div>
                  </div>
                </div>

                <div class="form__group mt-4" *ngIf="actionTypeCtrl.value === eventActionValues.ConsumerAttachments">
                  <app-attachments label="Pièces jointes fournies par le consommateur (visibles par l'entreprise et la DGCCRF)"
                                   [uploadedFiles]="uploadedFiles"
                                   [origin]="fileOrigins.Consumer">
                  </app-attachments>
                </div>

                <div class="form__group mt-4" *ngIf="actionTypeCtrl.value === eventActionValues.ProfessionalAttachments">
                  <app-attachments label="Pièces jointes fournies par l'entreprise (visibles par l'entreprise et la DGCCRF)"
                                   [uploadedFiles]="uploadedFiles"
                                   [origin]="fileOrigins.Professional">
                  </app-attachments>
                </div>

                <div class="form__group mt-4" *ngIf="actionTypeCtrl.value === eventActionValues.Control">
                  <div class="row">
                    <div class="col-12">
                      <label for="controlInput">
                        Détail du contrôle (facultatif)
                      </label>
                      <textarea id="controlInput" [formControl]="detailCtrl"></textarea>
                    </div>
                  </div>
                </div>

                <div class="notification error" *ngIf="showErrors && actionForm.invalid">
                  Veuillez renseigner les champs obligatoires.<br />
                </div>

                <div class="notification error" *ngIf="loadingError">
                  Une erreur technique s'est produite<br />
                </div>

                <div class="mt-4 text-center">
                  <button type="button" class="btn btn-lg btn-outline-primary" (click)="hideActionForm()">Annuler</button>
                  &nbsp;
                  <button type="submit" class="btn btn-lg btn-primary" [disabled]="isUploadingFile()">
                    Envoyer
                  </button>
                </div>

              </ng-container>
            </form>
            <ngx-loading [show]="loading"></ngx-loading>
          </div>
        </ng-template>
        <div class="notification success" *ngIf="responseSuccess">
          Votre saisie a bien été prise en compte, nous vous en remercions.
        </div>
      </div>
    </ng-container>
  </div>
</section>

<div class="container pb-3" *ngIf="report && backEnabled()">
  <div class="row">
    <div class="col-12 pointer" (click)="back()">
      <img src="/assets/images/icon_back.png" class="back pointer" alt="page précédente"/>
      Retour à la liste
    </div>
  </div>
</div>
